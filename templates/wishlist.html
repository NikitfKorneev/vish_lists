<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Мои Wishlists</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="corner-plant" id="cornerPlant"></div>

    <header>
        <div class="container header-content">
            <h1>Мои Wishlists</h1>
            <div>
                <a href="/public" style="color:#3b82f6; margin-right:1.2rem;">Публичные списки</a>
                <a href="/calendar" style="color:#3b82f6; margin-right:1.2rem;">Полный календарь</a>
                <a href="/logout" class="logout">Выйти</a>
            </div>
        </div>
    </header>

    <div class="main-layout">
        <!-- Левая часть: создание и список вишлистов -->
        <div class="content">
            <div class="card" style="margin-bottom: 3rem;">
                <h2 style="margin-top:0;">Создать новый список</h2>
                <form method="POST" action="/wishlist/create">
                    <input 
                        type="text" 
                        name="title" 
                        placeholder="Например: День рождения 2026" 
                        required 
                        autofocus
                    >
                    <textarea 
                        name="description" 
                        placeholder="Описание (необязательно)" 
                        rows="2"
                    ></textarea>
                    <button type="submit">Создать список</button>
                </form>
            </div>

        {% if wishlists %}
        <h2 style="margin-bottom:1.5rem;">Ваши списки</h2>
        <div class="grid">
            {% for wl in wishlists %}
            {% endfor %}
        </div>
        {% else %}
        <div style="text-align:center; padding:4rem 0; color:#9ca3af;">
            У вас пока нет списков желаний<br>
            Создайте первый выше ↑
        </div>
        {% endif %}
    </div>

    <!-- Правая часть: календарь -->
    <aside class="sidebar">
        <div class="calendar-header">
            <button onclick="prevMonth()">←</button>
            <h3 id="monthYear">Январь 2026</h3>
            <button onclick="nextMonth()">→</button>
        </div>

        <div class="calendar-grid" id="calendarDays"></div>
    </aside>
</div>

<script>
    let currentDate = new Date(); // текущая дата
    const monthNames = ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь",
                        "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"];
    const colors = ["#ef4444", "#3b82f6", "#10b981", "#f59e0b", "#8b5cf6", "#ec4899", "#14b8a6"];

    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();

        document.getElementById("monthYear").textContent = monthNames[month] + " " + year;

        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay() || 7;

        const calendarDays = document.getElementById("calendarDays");
        calendarDays.innerHTML = '';

        // Названия дней недели
        ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'].forEach(day => {
            const div = document.createElement('div');
            div.className = 'calendar-day-name';
            div.textContent = day;
            calendarDays.appendChild(div);
        });

        // Пустые дни
        for (let i = 1; i < startingDayOfWeek; i++) {
            const div = document.createElement('div');
            div.className = 'calendar-day empty';
            calendarDays.appendChild(div);
        }

        // Дни месяца
        for (let day = 1; day <= daysInMonth; day++) {
            const div = document.createElement('div');
            div.className = 'calendar-day';
            div.textContent = day;

            const today = new Date();
            if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                div.classList.add('today');
            }

            div.onclick = function() {
                const selectedDate = `${year}-${String(month + 1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
                window.location.href = `/calendar/add?date=${selectedDate}`;
            };

            calendarDays.appendChild(div);
        }

        loadEvents(year, month + 1);
    }

    async function loadEvents(year, month) {
        try {
            const response = await fetch(`/calendar/events/${year}/${month}`);
            const events = await response.json();

            document.querySelectorAll('.calendar-day:not(.empty)').forEach(day => {
                const dayNum = day.textContent.trim();

                // если такой день есть в events (даже если 0)
            if (dayNum in events) {
                day.classList.add('has-events'); // выделяем цветом

                // если есть хотя бы один wishlist — рисуем точку
                if (events[dayNum] > 0) {
                    const dotsContainer = document.createElement('div');
                    dotsContainer.className = 'event-dots';

                    const dot = document.createElement('span');
                    dot.className = 'event-dot';
                    dot.style.backgroundColor = '#ef4444';

                    dotsContainer.appendChild(dot);
                    day.appendChild(dotsContainer);
                }
            }
        });

    } catch (error) {
        console.error("Ошибка загрузки событий:", error);
    }
}


    function prevMonth() {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
    }

    function nextMonth() {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
    }

    renderCalendar();


    const plants = [
        "/static/images/plant1.png",
        "/static/images/plant2.png",
        "/static/images/plant3.png",
        "/static/images/plant4.png",
        "/static/images/plant5.png",
        "/static/images/plant6.png",
        "/static/images/plant7.png"
    ];

    const chosen = plants[Math.floor(Math.random() * plants.length)];

    const plantDiv = document.getElementById("cornerPlant");
    plantDiv.style.backgroundImage = `url("${chosen}?v=${Date.now()}")`;

</script>
